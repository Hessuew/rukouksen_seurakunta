---
import Layout from '~/layouts/PageLayout.astro';
import Spacer from '~/components/widgets/Spacer.astro';
import Hero from '~/components/widgets/Hero.astro';
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

// Import images
import skrLogo from '~/assets/images/funders/Skr Logo.svg';
import wihuriLogo from '~/assets/images/funders/Wihuri Foundation Logo.svg';
import orionLogo from '~/assets/images/funders/Orion Oyj Logo.svg';
import pauloLogo from '~/assets/images/funders/Paulon Saatio Logo.png';
import uefLogo from '~/assets/images/funders/UEF Logo.png';
import paavoNurmiLogo from '~/assets/images/funders/paavo-nurmi-foundation-logo.webp';
import yjsLogo from '~/assets/images/funders/YJS Anniversary Logo.png';
import leroyLogo from '~/assets/images/funders/Leroy Logo Navigation.png';
import pediatricLogo from '~/assets/images/funders/Lastentautientutkimussaatio.png';
import idaMontinLogo from '~/assets/images/funders/Idamontin Insaatio Logo Dark.png';
import kordelinLogo from '~/assets/images/funders/Kordelin.jpeg';
import easoLogo from '~/assets/images/funders/EASO.jpeg';

interface Funder {
  name: string;
  logo?: ImageMetadata;
  url: string;
  label?: {
    text: string;
    style: string;
  };
  wider?: boolean;
  small?: boolean;
}

const metadata = {
  title: 'Funders | urFIT-child Research Project',
  description:
    'Our research is supported by prestigious organizations including the Academy of Finland, Finnish Cultural Foundation, and European Association for the Study of Obesity. Learn about the partners enabling our groundbreaking childhood health research.',
};

const funders: Funder[] = [
  {
    name: 'Central Finnish Cultural Foundation',
    logo: skrLogo,
    url: 'https://skr.fi/en',
  },
  {
    name: 'Jenny and Antti Wihuri Foundation',
    logo: wihuriLogo,
    url: 'https://wihurinrahasto.fi/?lang=en',
  },
  {
    name: 'The North Savo regional Finnish Cultural Foundation',
    label: {
      text: 'North Savo Grants',
      style: 'text-green-700 font-bold',
    },
    url: 'https://skr.fi/en',
    wider: true,
  },
  {
    name: 'Orion Research Foundation',
    logo: orionLogo,
    url: 'https://www.orion.fi/en/science/orion-research-foundation/',
    small: true,
  },
  {
    name: 'Aarne Koskelo Foundation',
    label: {
      text: 'Aarne Koskelo',
      style: 'italic font-serif text-gray-700',
    },
    url: 'http://www.aarnekoskelonsaatio.fi/',
  },
  {
    name: 'Antti and Tyyne Soininen Foundation',
    logo: uefLogo,
    url: 'https://www.uef.fi/en/university-foundations',
  },
  {
    name: 'Paulo Foundation',
    logo: pauloLogo,
    url: 'https://paulo.fi/apurahat',
  },
  {
    name: 'Paavo Nurmi Foundation',
    logo: paavoNurmiLogo,
    url: 'https://www.paavonurmensaatio.fi/en/foundation/',
  },
  {
    name: 'YrjÃ¶ Jahnsson Foundation',
    logo: yjsLogo,
    url: 'https://www.yjs.fi/en/',
  },
  {
    name: 'Finnish Foundation for Cardiovascular Research',
    logo: leroyLogo,
    url: 'https://www.sydantutkimussaatio.fi/en/foundation',
  },
  {
    name: 'Pediatric Research Foundation',
    logo: pediatricLogo,
    url: 'https://www.lastentautientutkimussaatio.fi/',
  },
  {
    name: 'Ida Montin Foundation',
    logo: idaMontinLogo,
    url: 'https://idamontininsaatio.fi/',
  },
  {
    name: 'Alfred Kordelin Foundation',
    logo: kordelinLogo,
    url: 'https://kordelin.fi/en/frontpage',
  },
  {
    name: 'European Association for the Study of Obesity',
    logo: easoLogo,
    url: 'https://www.uef.fi/en/article/andrew-agbaje-wins-prestigious-easo-novo-nordisk-foundation-new-investigator-award-in-childhood',
  },
];

// Structured data for research funding organizations
const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'ResearchProject',
  name: 'urFIT-child Research Project',
  description:
    'Research project focusing on childhood health and fitness, supported by multiple prestigious funding organizations.',
  funder: funders.map((funder) => ({
    '@type': 'Organization',
    name: funder.name,
    url: funder.url,
  })),
};
---

<Layout metadata={metadata}>
  {/* Add structured data */}
  <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />

  <div class="relative">
    <div
      class="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-transparent to-purple-50/30 dark:from-blue-950/30 dark:to-purple-900/20"
    >
    </div>
    <Hero
      classes={{
        container: 'relative z-10',
        labelContainer: 'pb-0 md:pb-0 lg:pb-0',
      }}
      tagline="Funders"
      title="Our Funders"
      subtitle="We are grateful for the support of our esteemed funding partners who make our research possible."
    />
  </div>

  <section class="relative z-10 py-16 px-4 max-w-7xl mx-auto" aria-label="Funders grid">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" role="list">
      {
        funders.map((funder: Funder, index: number) => (
          <a
            href={funder.url}
            target="_blank"
            rel="noopener noreferrer"
            class="block no-underline hover:no-underline group opacity-0 translate-y-8 duration-1000 ease-out focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg"
            data-intersect
            aria-label={`Visit ${funder.name} website`}
            role="listitem"
            style={`--animation-delay: ${index * 100}ms`}
          >
            <div class="bg-white dark:bg-gray-900/10 rounded-lg shadow-lg dark:shadow-gray-900/30 p-6 h-full transition-all duration-300 hover:bg-gray-100/0 dark:hover:bg-white/0 group-hover:shadow-xl">
              <div class="flex flex-col items-center h-full">
                <div
                  class={`mb-4 flex items-center justify-center p-4 rounded-lg bg-transparent dark:bg-white transition-transform duration-300 ease-out group-hover:scale-105 ${
                    funder.wider ? 'w-80 h-40' : funder.small ? 'w-48 h-32' : 'w-64 h-40'
                  }`}
                  role="img"
                  aria-label={funder.logo ? `${funder.name} logo` : funder.label?.text}
                >
                  {funder.logo ? (
                    <div class="w-full h-full flex items-center justify-center">
                      <Image
                        src={funder.logo}
                        alt={`${funder.name} logo`}
                        class="max-w-full max-h-full object-contain dark:brightness-110 dark:contrast-125 transition-transform duration-300"
                        width={funder.wider ? 300 : funder.small ? 160 : 240}
                        height={funder.wider ? 150 : funder.small ? 100 : 150}
                        loading={index < 6 ? 'eager' : 'lazy'}
                        decoding={index < 6 ? 'sync' : 'async'}
                      />
                    </div>
                  ) : (
                    <div class="w-full h-full flex items-center justify-center">
                      <span
                        class={`text-3xl font-semibold ${funder.label?.style || 'text-gray-600 dark:text-gray-300'}`}
                      >
                        {funder.label?.text}
                      </span>
                    </div>
                  )}
                </div>
                <div class="text-center mt-auto">
                  <h3 class="text-xl font-semibold text-gray-800 dark:text-gray-100">{funder.name}</h3>
                  <span
                    class="text-sm text-blue-600 dark:text-blue-600 mt-2 inline-flex items-center gap-1 transition-all duration-300 group-hover:gap-2"
                    aria-hidden="true"
                  >
                    Visit website
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="h-4 w-4 transition-transform duration-300 transform group-hover:translate-x-1"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      aria-hidden="true"
                      role="presentation"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </span>
                </div>
              </div>
            </div>
          </a>
        ))
      }
    </div>
  </section>

  <section class="py-8 px-4 max-w-3xl mx-auto" aria-labelledby="acknowledgment-title">
    <div
      class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-8 opacity-0 translate-y-8 duration-1000 ease-out"
      data-intersect
    >
      <h2 id="acknowledgment-title" class="text-2xl font-bold text-center mb-4 text-blue-900 dark:text-blue-100">
        Acknowledgment
      </h2>
      <p class="text-gray-700 dark:text-gray-300 leading-relaxed text-center">
        Dr Agbaje's research group (urFIT-child) is supported by research grants from various prestigious foundations
        and organizations. Their generous support enables us to conduct cutting-edge research and make meaningful
        contributions to our field.
      </p>
    </div>
  </section>

  <Spacer size="sm" />
</Layout>

<style>
  .grid {
    --auto-grid-min-size: 16rem;
  }

  [data-intersect] {
    animation-delay: var(--animation-delay, 0ms);
  }

  [data-intersect].intersected {
    opacity: 1;
    transform: translateY(0);
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(1rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  function initIntersectionObserver() {
    const elements = document.querySelectorAll('[data-intersect]');

    const observer = new IntersectionObserver(
      (entries: IntersectionObserverEntry[]) => {
        entries.forEach((entry: IntersectionObserverEntry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('intersected');
            observer.unobserve(entry.target);
          }
        });
      },
      {
        root: null,
        rootMargin: '0px',
        threshold: 0.1,
      }
    );

    elements.forEach((element: Element) => observer.observe(element));
  }

  // Initialize on page load
  initIntersectionObserver();

  // Re-initialize on view transitions
  document.addEventListener('astro:page-load', initIntersectionObserver);

  // Add keyboard navigation for funder cards
  document.addEventListener('astro:page-load', () => {
    const links = document.querySelectorAll<HTMLAnchorElement>('[role="listitem"]');
    links.forEach((link) => {
      link.addEventListener('keydown', (e: KeyboardEvent) => {
        if (e.key === ' ') {
          e.preventDefault();
          link.click();
        }
      });
    });
  });
</script>
